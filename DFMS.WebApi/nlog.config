<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    autoReload="true"
    internalLogLevel="Info"
    internalLogFile="c:\temp\internal-nlog-AspNetCore.txt">
    <extensions>
        <add assembly="NLog.Web.AspNetCore"/>
    </extensions>
    <variable name="myLayout" value="${longdate} | ${uppercase:${level}} | ${logger} | ${message}${onexception:${newline}}${exception:format=tostring}" />
	<variable name="sqlCommandLayout" value="${longdate} | ${uppercase:${level}} | ${message}${onexception:${newline}}${exception:format=tostring} ${newline}" />
    <targets>
        <target xsi:type="File" name="all-file" fileName="${basedir}\all_logs_${shortdate}.log" layout="${myLayout}" />
        <target xsi:type="File" name="error-file" fileName="${basedir}\errors_${shortdate}.log" layout="${myLayout}" />
        <target xsi:type="File" name="database-file" fileName="${basedir}\database_${shortdate}.log" layout="${sqlCommandLayout}" />
		<target xsi:type="ColoredConsole" name="log-console-error">
			<highlight-row condition="true" foregroundColor="red"/>
		</target>
		<target xsi:type="ColoredConsole" name="log-console-warn">
			<highlight-row condition="true" foregroundColor="yellow"/>
		</target>
	    <target xsi:type="ColoredConsole" name="log-console-info">
			<highlight-row condition="true" foregroundColor="green"/>
		</target>
	    <target xsi:type="ColoredConsole" name="log-console-my">
			<highlight-row condition="true" foregroundColor="blue"/>
		</target>
    </targets>
    <rules>
		<logger name="*" minlevel="Error" writeTo="error-file" />
		<logger name="*" minlevel="Info" writeTo="all-file,log-console-info">
			<logger name="*" minlevel="Warn" writeTo="all-file,log-console-warn">
				<logger name="*" minlevel="Error" writeTo="all-file,log-console-error" />
			</logger>
            <filters defaultAction='Log'>
                <when condition="starts-with('${logger}', 'Microsoft.EntityFrameworkCore')" action="Ignore" />
            </filters>
		</logger>
        <logger name="Microsoft.EntityFrameworkCore.Database.Command" minlevel="Trace" writeTo="database-file,log-console-my">
            <filters defaultAction='Ignore'>
                <when condition="starts-with('${message}', 'Executing DbCommand')" action="Log" />
            </filters>
        </logger>
    </rules>
</nlog>